<extend name="Common:base" />

<block name='css'>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/amazeui.tagsinput.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/amazeui.chosen.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/amazeui.datetimepicker.css"/>
</block>

<block name="main">
<div class="am-g">
	<div class="am-u-sm-10 am-u-md-8 am-u-lg-6 am-u-sm-centered am-padding-top" style="background-color: rgba(255,255,255,0.4);">
		<img id="p_img" width="254" src="__PUBLIC__/{$data.savepath}t_{$data.savename}" />
		<p><label style="color: #DD514C;">时光碎片<span id="help_inline">{$data.share_id}</span></label></p>
		<div class="am-form-group">
			<input type="hidden" name="share_id" id="share_id" value="{$data.share_id}" />
			<label>标签</label><span class="am-text-xs"> 按下回车键确认标签 请不要超过 7 个标签 每个标签 8 个字以内</span><br />
			<input id="doc-ipt-tag" name="tag_id" type="text" value="{$data.tag_id|get_tag}" data-role="tagsinput" />
			<br /><span class="am-text-sm hot-tag">热门标签：{$hot_tag|show_tag=true,true}</span>
		</div>
		<form class="am-form" method="post">
			<fieldset style="padding: 0;">
				<div class="am-form-group" id="ajax-pv">
					<div class="am-form-group">
						<label for="doc-cho-catalog">分类</label>
						<select data-placeholder="选择一个分类吧" id="doc-cho-catalog" style="min-width:300px;" class="chosen-select" tabindex="7">
						  <option value=""></option>
							  <volist name="catalog" id="vo">
							  	<if condition="$vo['catalog_id'] eq $data['catalog_id']">
									  <option value="{$vo.catalog_id}" selected>{$vo.catalog_name}</option>
							  	<else />
									  <option value="{$vo.catalog_id}">{$vo.catalog_name}</option>
							  	</if>
							  </volist>
						</select>
					</div>
					<div class="am-form-group">
						<label for="doc-ipt-detail">说点什么</label>
						<textarea class="" rows="4" name="detail" id="doc-ipt-detail" placeholder="非必填，255 字以内">{$data.detail}</textarea>
					</div>
					<div class="am-input-group am-input-group-dange">
						<label for="datetimepicker">拍摄时间</label>
						<span class="am-padding-left-sm am-text-sm am-text-primary">如果您的照片存在exif信息，那么已经根据您的照片信息自动填入时间</span>
						<input id="datetimepicker" type="text" value="{$data.time|time_format='Y-m-d H:i'}" class="am-form-field" readonly>
					</div>
					<div class="am-cf">
						<button type="button" class="am-btn am-fr am-btn-danger" onclick="return modi();">提交</button>
					</div>
				</div>
			</fieldset>
		</form>
	</div>

</div>
</block>

<block name="js">
<script src="__PUBLIC__/js/amazeui.tagsinput.min.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/amazeui.chosen.min.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/js/amazeui.datetimepicker.min.js" language="javascript" type="text/javascript"></script>
<script src="__PUBLIC__/js/datetimepicker.zh.js" language="javascript" type="text/javascript"></script>
<script type="text/javascript">
$(function() {
	$('#doc-cho-catalog').chosen();
	$('#datetimepicker').datetimepicker({
		format: 'yyyy-mm-dd hh:ii',
    todayBtn: true,
    pickerPosition: 'top-left',
    endDate: '{$now}',
    language:  'zh-CN'
	});
});

$('#doc-ipt-tag').tagsinput({
  maxTags: 7,
  maxChars: 12
});
$(".tag-badge").on('click', function() {
	var data = $(this).data('tag-id');
	$('#doc-ipt-tag').tagsinput('add', data);
});

function modi() {
	$.ajax({
		url: "{:U('Shard/modi')}",
		type: 'POST',
		data:{
			share_id: {$data.share_id},
			tag_id: $("#doc-ipt-tag").val(),
			detail: $("#doc-ipt-detail").val(),
			catalog_id: $("#doc-cho-catalog").val(),
			time: $("#datetimepicker").val()
		},
		success: function(data) {
			if(data.status) {
				modalPopup('哦也 XD');
				setTimeout(function() {
					window.location.href = "__ROOT__/" + $("#help_inline").text();
				}, 1200);
			} else {
				modalPopup('失败了，参考可能原因:'+ data.info);
			}
		}
	});
	return false;//为了防止刷新
}
</script>
</block>